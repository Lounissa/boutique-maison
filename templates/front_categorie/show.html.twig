{% extends "base.html.twig" %}

{% block title %}{{ categorie.nom}}{% endblock %}

{% block body %}

<h1>{{ categorie.nom }}</h1>
    <div class="row">
        {% if categorie.imageName is not null %}
            {% set image = categorie.imageName %}
        {% else %}
            {% set image = "default.jpg" %}
        {% endif %}
        <div class="col-12 col-md-3">
            <img src="{{ asset('images/categorie/' ~ image) }}" alt="Illustration de la catégorie {{ categorie.nom }}" class="img-fluid">
        </div>
        <div class="col-12 col-md-9">
        {% if categorie.description is not null %}
        {{ categorie.description|raw }}
        {% else %}
        <p>Il n'y a pas encore de description pour cette catégorie.</p>
        {% endif %}
        </div>
    </div>
<div class="d-flex flex-wrap justify-content-between align-items-center">
    <h2 class="mt-5">Nos Produits </h2>
    <form  method="post" class="d-flex">
        <input type="search" name="search" class="form-control" required>
        <button type="submit" class="btn btn-success"><i class="fa-solid fa-magnifying-glass"></i></button>
    </form>
</div>

<div class="row">
{% for produit in categorie.produits %}
<div class="col-12 col-md-3 col-lg-2 d-flex align-items-stretch">
    <div class="card">
        {% if produit.images|length > 0 %}
            {% set image = produit.images[0].imageName %}
        {% else %}
            {% set image = "default.jpg" %}
        {% endif %}
        <img src="{{ asset('images/produit/' ~ image) }}" class="card-img-top" alt="{{ produit.nom }}">
        <div class="card-body d-flex flex-wrap">
            <h5 class="card-title">{{ produit.nom }}</h5>
            <div class="align-self-end w-100">
                <p class="card-text">{{ produit.prix|format_currency ('EUR') }}</p>
                <div class="d-flex flex-wrap justify-content-between w-100">
                    <a href="{{ path('app_front_produit', {slug: produit.slug}) }}" class="btn btn-success">Voir</a>
                    {% if app.user is not null %}
                        {% set isInFavori = false %}
                        {% for favori in app.user.favoris %}
                            {% if favori.produit == produit %}
                            {% set isInFavori = true %}
                            {% endif %}
                        {% endfor %}
                        <button class="btn btn-success add-favori" data-produit-id="{{ produit.id }}"><i class="{% if isInFavori 
                    == true %}fa-solid{% else %}fa-regular{% endif %} fa-heart"></i></button>
                    {% endif %} 
                </div>
            </div>
        </div>
    </div>
</div>
{% endfor %}
</div>
{% endblock %} 